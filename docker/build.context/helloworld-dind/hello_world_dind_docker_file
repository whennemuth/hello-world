FROM tomcat:8-jre8
MAINTAINER Warren

ENV JAVA_OPTS="-Xmx8192m"
ENV TOMCAT_LOCATION="/usr/local/tomcat"
ENV JENKINS_ROOT="http://ec2-52-37-165-82.us-west-2.compute.amazonaws.com:8080/jenkinsdind"
ENV SOURCE_WAR="${JENKINS_ROOT}/view/Hello%20World/job/deploy-war-file-dind/ws/target/hello-world-0.0.1-SNAPSHOT.war"
ENV TARGET_WAR="${TOMCAT_LOCATION}/webapps/helloworlddind.war"

USER root

# Allow write access for jenkins to save war files
RUN chmod a+w -R $TOMCAT_LOCATION/webapps

# Copy in the hello-world war file into the image from its jenkins build location
RUN [ "sh", "-c", "echo", "$DOCKER_HOST" ] 
RUN curl -sSL $SOURCE_WAR > $TARGET_WAR

CMD ["${TOMCAT_LOCATION}/bin/catalina.sh", "run"]